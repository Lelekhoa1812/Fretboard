<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Test</title>
    <link rel="stylesheet" href="./styles/globals.css">
    <style>
        body { padding: 20px; }
        .debug-info { 
            background: #333; 
            color: #fff; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
        }
    </style>
</head>
<body>
    <div class="debug-info">
        <h3>Debug Information</h3>
        <div id="debug-output"></div>
    </div>
    
    <div class="settings visible" id="app-root">
        <div class="fretboard" id="test-fretboard"></div>
        <div class="note-name-section" id="test-note-names"></div>
    </div>

    <script>
        function debugLog(message) {
            const debugOutput = document.getElementById('debug-output');
            debugOutput.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
            console.log(message);
        }
        
        function generateTestFretboard() {
            debugLog('Starting fretboard generation...');
            
            const fretboard = document.getElementById('test-fretboard');
            if (!fretboard) {
                debugLog('ERROR: Fretboard element not found');
                return;
            }
            
            const tuning = [4, 11, 7, 2, 9, 4]; // Guitar tuning
            const numberOfFrets = 8;
            const accidentals = 'flats';
            
            debugLog('Setting CSS variables...');
            // Set CSS variables
            document.documentElement.style.setProperty('--number-of-strings', tuning.length);
            document.documentElement.style.setProperty('--noteDotOpacity', '0.3');
            
            debugLog('CSS variables set: --number-of-strings=' + 
                document.documentElement.style.getPropertyValue('--number-of-strings') + 
                ', --noteDotOpacity=' + 
                document.documentElement.style.getPropertyValue('--noteDotOpacity'));
            
            const notesFlat = ["C", "Db", "D", "Eb", "E", "F", "Gb", "G", "Ab", "A", "Bb", "B"];
            
            function getNoteNameByIndex(idx, acc) {
                idx = ((idx % 12) + 12) % 12;
                return acc === 'sharps' ? notesSharp[idx] : notesFlat[idx];
            }
            
            const notesSharp = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
            
            fretboard.innerHTML = '';
            debugLog('Fretboard cleared, generating strings...');
            
            tuning.forEach((openNote, stringIndex) => {
                const stringDiv = document.createElement('div');
                stringDiv.className = 'string';
                
                const singleFretMarkPositions = [3, 5, 7, 9, 15, 17, 19, 21];
                const doubleFretMarkPositions = [12, 24];
                
                for (let fret = 0; fret <= numberOfFrets; fret++) {
                    const fretDiv = document.createElement('div');
                    fretDiv.className = 'note-fret';
                    
                    // Add fret marks
                    if (stringIndex === 0 && singleFretMarkPositions.includes(fret)) {
                        fretDiv.classList.add('single-fretmark');
                    } else if (stringIndex === 0 && doubleFretMarkPositions.includes(fret)) {
                        fretDiv.classList.add('double-fretmark');
                    }
                    
                    // Calculate note for this fret
                    const noteIndex = (openNote + fret) % 12;
                    const noteName = getNoteNameByIndex(noteIndex, accidentals);
                    fretDiv.setAttribute('data-note', noteName);
                    fretDiv.setAttribute('data-fret', fret);
                    fretDiv.setAttribute('data-string', stringIndex);
                    fretDiv.setAttribute('data-string-index', stringIndex + 1);
                    fretDiv.setAttribute('data-fret-index', fret);
                    
                    stringDiv.appendChild(fretDiv);
                }
                
                fretboard.appendChild(stringDiv);
            });
            
            debugLog('Fretboard generated with ' + fretboard.children.length + ' strings');
            debugLog('Fretboard HTML: ' + fretboard.innerHTML.substring(0, 200) + '...');
        }
        
        function generateTestNoteNames() {
            debugLog('Generating note names...');
            const noteNameSection = document.getElementById('test-note-names');
            const notes = ["C", "Db", "D", "Eb", "E", "F", "Gb", "G", "Ab", "A", "Bb", "B"];
            
            noteNameSection.innerHTML = '';
            notes.forEach(noteName => {
                const span = document.createElement('span');
                span.textContent = noteName;
                span.style.cursor = 'pointer';
                span.style.padding = '10px';
                span.style.margin = '5px';
                span.style.borderRadius = '8px';
                span.style.transition = 'all 0.3s ease';
                noteNameSection.appendChild(span);
            });
            debugLog('Note names generated: ' + noteNameSection.children.length + ' notes');
        }
        
        // Initialize test
        document.addEventListener('DOMContentLoaded', () => {
            debugLog('DOM loaded, starting test...');
            generateTestFretboard();
            generateTestNoteNames();
            debugLog('Test completed');
        });
    </script>
</body>
</html>
